<details>
<summary>点击展开目录</summary>
<!-- TOC -->

- [分布式事务](#分布式事务)

<!-- /TOC -->
</details>


# 分布式事务

实现方案:两阶段提交(Two-phase Commit，2PC)

准备阶段:协调者确认所有事务参与者是否可以提交
提交阶段:所有参与者全部回复可以,协调者协调参与者提交事务

存在的问题:

* 参与者阻塞: 参与者相应协调者时,其他参与者处于等待状态
* 协调者太过重要: 协调者一旦故障,整个结构将不可用
* 数据一致性: 部分参与者提交时发生故障,导致数据一致性问题
* 保守: 一个参与者的事务失败,所有参与者的事务全部回滚

实现方案1:消息事务

基于消息中间件的两阶段提交,如RocketMQ,将分布式事务拆分成本地事务进行处理.
以转账为例,事务1扣钱成功,同时发出消息,通知事务2加钱.

具体的实现可分为两种:本地消息表与事务消息

![](https://raw.githubusercontent.com/LuVx21/doc/master/source/_posts/99.img/xa_mq.png)

事务消息方式:
1. 事务A发送事务执行预备消息
2. 收到MQ回复后执行事务
3. 根据执行的结果决定提交还是回滚消息

![](https://raw.githubusercontent.com/LuVx21/doc/master/source/_posts/99.img/xa_mq1.png)
图源见水印,侵删

实现方案2:TCC

Try,Commit,Cancel

https://www.oschina.net/p/seata

https://www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html

[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)
