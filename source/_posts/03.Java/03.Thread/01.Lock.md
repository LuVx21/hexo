---
title: å¹¶å‘ç¼–ç¨‹:é”
date:
tags:
- Java
---
<details>
<summary>ç‚¹å‡»å±•å¼€ç›®å½•</summary>
<!-- TOC -->

- [å…³äº](#å…³äº)
- [Lock](#lock)
    - [ReentrantLock](#reentrantlock)
        - [æ–¹æ³•](#æ–¹æ³•)
        - [Usage](#usage)
        - [å®ç°åŸç†](#å®ç°åŸç†)
- [ReadWriteLock](#readwritelock)
    - [ReentrantReadWriteLock](#reentrantreadwritelock)
        - [Usage](#usage-1)
        - [å®ç°åŸç†](#å®ç°åŸç†-1)
- [é”ä¼˜åŒ–](#é”ä¼˜åŒ–)
- [JVMçš„ä¼˜åŒ–](#jvmçš„ä¼˜åŒ–)
- [æ­»é”é¢„é˜²](#æ­»é”é¢„é˜²)
- [Q&A](#qa)
- [å‚è€ƒ](#å‚è€ƒ)

<!-- /TOC -->
</details>

## å…³äº


## Lock

### ReentrantLock

* å¯é‡å…¥çš„äº’æ–¥é”(æ’å®ƒé”)
* åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”, é»˜è®¤ä¸ºéå…¬å¹³, åŒºåˆ«åœ¨äºé”çš„è·å–æ˜¯å¦æŒ‰ç…§FIFOçš„é¡ºåº, ä½†å…¬å¹³é”æ€§èƒ½æœ‰æ‰€æ¬ ç¼º
* é€šè¿‡FIFOé˜Ÿåˆ—ç®¡ç†è·å–è¯¥é”ğŸ”æ‰€æœ‰çº¿ç¨‹çš„

å¯é‡å…¥:

åŒæ­¥é”ä¹Ÿæ˜¯å¯é‡å…¥çš„, å…·ä½“çš„ä¸€ä¸ªåœºæ™¯å°±æ˜¯åœ¨ä¸€ä¸ªåŒæ­¥åŸŸå†…è°ƒç”¨æœ¬ç±»çš„å…¶ä»–ç”±`synchronized`ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶,æ˜¯æ°¸è¿œå¯ä»¥å¾—åˆ°é”çš„

ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿé¿å…æ­»é”: çº¿ç¨‹è·å¾—æŸå¯¹è±¡çš„é”å, æœªé‡Šæ”¾çŠ¶æ€ä¸‹å†æ¬¡è·å–è¯¥å¯¹è±¡çš„é”æ—¶, å¦‚æœä¸æ”¯æŒé‡å…¥, å°±ä¼šé€ æˆæ­»é”.

![](https://dev.tencent.com/u/LuVx21/p/img/git/raw/master/ReentrantLock.jpg)

#### æ–¹æ³•

| æ–¹æ³•                                        | è¯´æ˜                                                 |
| ------------------------------------------- | ---------------------------------------------------- |
| `ReentrantLock(boolean fair)`               | æœ‰å‚æ„é€ , true:å…¬å¹³é”                                |
| `void lock()`                               | è·å–é”                                               |
| `boolean tryLock()`                         | å°è¯•éé˜»å¡å¼è·å–é”(æ–¹æ³•æ‰§è¡Œåç«‹å³è¿”å›)               |
| `boolean tryLock(long time, TimeUnit unit)` | è¶…æ—¶æ—¶é—´å†…è·å–é”,è·å–è¿‡ç¨‹ä¸­è¢«ä¸­æ–­,è¶…æ—¶ä¸‰ç§æƒ…å†µä¸‹è¿”å› |
| `void lockInterruptibly()`                  | è·å–é”çš„è¿‡ç¨‹ä¸­å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹                       |
| `void unlock()`                             | é‡Šæ”¾é”                                               |
| `Condition newCondition()`                  | è·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶,çº¿ç¨‹é—´é€šä¿¡ç”¨                        |

#### Usage

```Java
public static void main(String[] args) {
    Lock lock = new ReentrantLock();
    // Condition condition = lock.newCondition();// åˆ›å»ºCondition,å¯ä»¥å­˜åœ¨å¤šä¸ª
    new Thread(() -> doSome(lock), "thread1").start();
    new Thread(() -> doSome(lock), "thread2").start();
}
private static void doSome(Lock lock) {
    try {lock.lock();}
    ......;
    finally{lock.unlock();}
}
```

#### å®ç°åŸç†

```Java
private final Sync sync;
static abstract class Sync extends AbstractQueuedSynchronizer{}
final static class NonfairSync extends Sync{}
final static class FairSync extends Sync{}
```

**åŠ é”**

```Java
// éå…¬å¹³é”
final void lock() {
    if (compareAndSetState(0, 1))
        setExclusiveOwnerThread(Thread.currentThread());
    else // ç›´æ¥ä½¿ç”¨aqsçš„æ–¹æ³•
        acquire(1);
}
// å…¬å¹³é”
final void lock() {
    acquire(1);
}
```

å¯ä»¥çœ‹åˆ°å…³é”®éƒ¨åˆ†éƒ½åœ¨`acquire`æ–¹æ³•, å…¶å†…éƒ¨è°ƒç”¨`tryAcquire`æ–¹æ³•, è¯¥æ–¹æ³•éœ€è¦aqså®ç°ç±»æ¥å®ç°:

éå…¬å¹³é”çš„å®ç°:
```Java
protected final boolean tryAcquire(int acquires) {
    return nonfairTryAcquire(acquires);// Syncç±»ä¸­å®ç°
}
final boolean nonfairTryAcquire(int acquires) {
    final Thread current = Thread.currentThread();
    int c = getState();
    if (c == 0) {// é”æœªè¢«è·å–
        if (compareAndSetState(0, acquires)) {
            setExclusiveOwnerThread(current);
            return true;
        }
    }else if (current == getExclusiveOwnerThread()) {// ç‹¬å é”æŒæœ‰çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹
        int nextc = c + acquires;// é‡å…¥æ¬¡æ•°
        if (nextc < 0) // overflow:é‡å¤æ¬¡æ•°è¶…è¿‡65535
            throw new Error("Maximum lock count exceeded");
        setState(nextc);
        return true;
    }
    return false;
}
```

å…¬å¹³é”çš„`tryAcquire`çš„å®ç°å’Œéå…¬å¹³çš„åªæœ‰ä¸€ç‚¹ä¸åŒ, å°±æ˜¯`state=0`å†…çš„åˆ¤æ–­æ¡ä»¶å¤šäº†ä¸€ä¸ªä¸æ¡ä»¶`!hasQueuedPredecessors()`

```Java
public final boolean hasQueuedPredecessors() {
    Node t = tail;
    Node h = head;
    Node s;
    return h != t &&
            ((s = h.next) == null || s.thread != Thread.currentThread());
}
```
æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯: åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºCLHé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ª
// TODO

**é‡Šæ”¾é”**

```Java
public void unlock() {
    sync.release(1);
}
```
å…¶å†…éƒ¨ç›´æ¥ä½¿ç”¨`tryRelease`æ–¹æ³•, ç±»ä¼¼çš„, æ­¤æ–¹æ³•ä¹Ÿéœ€è¦å®ç°ç±»è¿›è¡Œå…·ä½“å®ç°:
```Java
protected final boolean tryRelease(int releases) {
    // å‡å°‘é‡å…¥æ¬¡æ•°
    int c = getState() - releases;
    // å½“å‰é‡Šæ”¾é”çš„çº¿ç¨‹ä¸æ˜¯æŒæœ‰è¯¥é”çš„çº¿ç¨‹ -> å¼‚å¸¸
    if (Thread.currentThread() != getExclusiveOwnerThread())
        throw new IllegalMonitorStateException();
    boolean free = false;
    if (c == 0) {// å·²ç»æ²¡æœ‰çº¿ç¨‹æŒæœ‰è¯¥é” 
        free = true;
        setExclusiveOwnerThread(null);
    }
    setState(c);
    return free;
}
```

## ReadWriteLock

æ˜¯ä¸€ä¸ªæ¥å£

ReentrantLocké”æ˜¯å®Œå…¨æ’ä»–é”,åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œ`lock.lock()`å’Œ`lock.unlock()`ä¹‹é—´çš„ä»£ç , å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­å¾€å¾€æ˜¯è¯»å¤šå†™å°‘, è€Œè¯»ä¸æ¶‰åŠæ•°æ®ç«äº‰,
å› æ­¤, ä¸ºäº†è¯»è€ŒåŠ é”å¿…å®šå½±å“å…¶ä»–çº¿ç¨‹çš„è¯»æˆ–å†™, å› æ­¤å‡ºç°äº†è¯»å†™é”.

### ReentrantReadWriteLock

ReentrantReadWriteLocké€šè¿‡åˆ›å»º2ä¸ªå®ç°äº†Lockæ¥å£çš„å†…éƒ¨ç±»`ReadLock`,`WriteLock`æ¥ç»´æŠ¤ä¸€å¯¹é”, åŒä¸€æ—¶é—´å…è®¸å¤šä¸ªè¯»æ“ä½œè¿›è¡Œ, å®ç°æ€§èƒ½çš„æå‡.
ä½†å†™æ“ä½œä»ç„¶æ˜¯äº’æ–¥çš„, åªè¦æ¶‰åŠåˆ°å†™é”, å…¶ä»–çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡

* è¯»é”: å…±äº«, é‡å…¥, æ”¯æŒå…¬å¹³å’Œéå…¬å¹³
* å†™é”: æ’ä»–, é‡å…¥, æ”¯æŒå…¬å¹³å’Œéå…¬å¹³, å¯é™çº§ä¸ºè¯»é”

ç”±äºå†™é”æ˜¯æ’ä»–çš„,åªè¦æ¶‰åŠåˆ°å†™æ“ä½œéƒ½æ˜¯äº’æ–¥çš„,ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°å†™é”åä¸é‡Šæ”¾å†™é”ä¹Ÿèƒ½ç»§ç»­è·å–åˆ°è¯»é”,å³é™çº§ä¸ºè¯»é”.

![](https://dev.tencent.com/u/LuVx21/p/img/git/raw/master/ReentrantReadWriteLock.png)

#### Usage


#### å®ç°åŸç†

```Java
private final ReentrantReadWriteLock.ReadLock readerLock;
private final ReentrantReadWriteLock.WriteLock writerLock;
final Sync sync;
public ReentrantReadWriteLock() {
    this(false);
}
public ReentrantReadWriteLock(boolean fair) {
    sync = fair ? new FairSync() : new NonfairSync();
    readerLock = new ReadLock(this);
    writerLock = new WriteLock(this);
}
abstract static class Sync extends AbstractQueuedSynchronizer {}
static final class FairSync extends Sync {}
static final class NonfairSync extends Sync {}
public static class ReadLock implements Lock, java.io.Serializable {}
public static class WriteLock implements Lock, java.io.Serializable {}
```

**é”çŠ¶æ€çš„è®°å½•**

ReentrantLockä¸­æ˜¯ä½¿ç”¨AQSä¸­çš„stateå±æ€§è®°å½•é”çš„çŠ¶æ€,ReentrantReadWriteLockæœ‰2æŠŠé”,å…¶çŠ¶æ€æ€æ ·è®°å½•?

åœ¨åŒä¸€ä¸ªæ•´å½¢å˜é‡ä¸Š,è¡¨ç¤º2æŠŠé”çš„çŠ¶æ€,å°±éœ€è¦å°†è¿™ä¸ªå˜é‡æŒ‰ä½åˆ†å‰²ä½¿ç”¨,é«˜16ä½è®°å½•è¯»é”,ä½16ä½è®°å½•å†™é”.

`Sync`ç±»å†…éƒ¨:
```Java
static final int SHARED_SHIFT   = 16;
static final int EXCLUSIVE_MASK = (1 << SHARED_SHIFT) - 1;
// å³ç§»16ä½, è·å–è¯»é”çŠ¶æ€
static int sharedCount(int c)    { return c >>> SHARED_SHIFT; }
// æ¶ˆå»é«˜16ä½, è·å–å†™é”çŠ¶æ€
static int exclusiveCount(int c) { return c & EXCLUSIVE_MASK; }
```

## é”ä¼˜åŒ–

é”ç«äº‰åŠä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šå¯¼è‡´ç¨‹åºæ€§èƒ½çš„ä¸‹é™,å› æ­¤å¯¹é”çš„ä¼˜åŒ–ä¹Ÿæ˜¯æœ‰å¿…è¦çš„.

* å‡å°‘é”æŒæœ‰çš„æ—¶é—´:å’Œé™ä½é”ç²’åº¦å¾ˆç›¸ä¼¼,ä¸è¦å°†è€—æ—¶çš„æ“ä½œæ”¾å…¥åŒæ­¥åŸŸ
* å‡å°é”ç²’åº¦:Java7ä¸­ConcurrentHashMapçš„å®ç°å°±åˆ©ç”¨äº†è¿™ç§ä¼˜åŒ–æ–¹å¼
* è¯»å†™é”æ›¿æ¢ç‹¬å é”:ReentrantReadWriteLockåŒºåˆ«ReentrantLockçš„åœ°æ–¹å°±ä½“ç°å‡ºè¿™ç§æ–¹å¼,åªæœ‰æ¶‰åŠåˆ°å†™æ“ä½œæ‰ä¼šé˜»å¡
* é”åˆ†ç¦»:è¯»å†™é”çš„åŸºç¡€ä¸Šæ›´è¿›ä¸€æ­¥,LinkedBlockingQueue(åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—,è¯»å†™åˆ†ç¦»)å°±ä½¿ç”¨äº†è¿™ç§æ–¹å¼,å­˜åœ¨takeLockå’ŒputLockä¸¤ç§é”
* é”ç²—åŒ–:å¤šä¸ªé”åˆå¹¶ä¸ºåŒä¸€ä¸ªé”,ä¸å‡å°é”ç²’åº¦ç›¸å,å¢å¤§äº†åŒæ­¥åŸŸä»¥é¿å…é¢‘ç¹åˆ‡æ¢ä¸Šä¸‹æ–‡,æ‰€ä»¥æœ‰ç‰¹æ®Šçš„é€‚ç”¨åœºæ™¯
* é”æ¶ˆé™¤:ç¼–è¯‘å™¨å‘ç°ä¸å¯èƒ½è¢«å…±äº«çš„å¯¹è±¡,å¯ä»¥æ¶ˆé™¤è¿™äº›å¯¹è±¡çš„é”æ“ä½œ,å¦‚æŸäº›ç±»çš„æ–¹æ³•æ—¶åŠ äº†é”,ä½†å´ç”¨åœ¨ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æƒ…å½¢ä¸‹
* JVMçš„ä¼˜åŒ–:åå‘é”, è½»é‡çº§é”, é‡é‡çº§é”ç­‰

## JVMçš„ä¼˜åŒ–

synchronizedçš„é”æ˜¯äº’æ–¥é”, å¯¹æ€§èƒ½æœ‰å¾ˆå¤§å½±å“, å› æ­¤ä»Java6å¼€å§‹å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”, ä»¥åŠé”çš„å­˜å‚¨ç»“æ„å’Œé”å‡çº§æœºåˆ¶.

synchronizedé”æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´ä¸­, æ•°ç»„ç±»å‹ç”¨3ä¸ªå­—å®½(Word)å­˜å‚¨å¯¹è±¡å¤´, å…¶ä»–ç±»å‹ç”¨2ä¸ªå­—å®½(32ä½VMä¸‹1å­—å®½ä¸º4å­—èŠ‚).

![](https://dev.tencent.com/u/LuVx21/p/img/git/raw/master/obj_head.png)

å¯¹è±¡å¤´çš„Mark Word(32ä½):

| é”çŠ¶æ€   | 25ä½           | 4ä½          | æ˜¯å¦ä¸ºåå‘é”(1ä½) | é”æ ‡å¿—ä½(2ä½) |
| -------- | -------------- | ------------ | ----------------- | ------------- |
| æ— é”çŠ¶æ€ | å¯¹è±¡çš„hashcode | å¯¹è±¡åˆ†ä»£å¹´é¾„ | 0                 | 01            |

> å…¶ä¸­, é”çŠ¶æ€å…±æœ‰4ç§, çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯: æ— é”çŠ¶æ€, åå‘é”çŠ¶æ€, è½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€, é”å¯ä»¥å‡çº§ä¸”ä¸èƒ½é€†å‘

![](https://dev.tencent.com/u/LuVx21/p/img/git/raw/master/åå‘é”.png)

![](https://dev.tencent.com/u/LuVx21/p/img/git/raw/master/è½»é‡çº§é”.png)

* è‡ªæ—‹é”: é¿å…æŒ‚èµ·çº¿ç¨‹çš„ä¸€ç§å°è¯•.å¦‚æœçº¿ç¨‹ä¸€ç›´æ— æ³•è·å¾—é”, å¹¶ä¸”èƒ½è·å–çš„æ—¶é—´ç‚¹ä¹ŸæœªçŸ¥, å°±ä¼šè®©å½“å‰çº¿ç¨‹åšå‡ ä¸ªç©ºå¾ªç¯
* åå‘é”: åå‘é”å°±æ˜¯ä¸€æ—¦çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—äº†ç›‘è§†å¯¹è±¡, ä¹‹åè®©ç›‘è§†å¯¹è±¡"åå‘"è¿™ä¸ªçº¿ç¨‹, ä¹‹åçš„å¤šæ¬¡è°ƒç”¨åˆ™å¯ä»¥é¿å…CASæ“ä½œ
* è½»é‡çº§é”: åå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å—çš„æƒ…å†µä¸‹, å½“ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”ç«äº‰çš„æ—¶å€™, åå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”
* é‡é‡çº§é”: JVMä¸­åˆå«å¯¹è±¡ç›‘è§†å™¨(Monitor), å®ƒè‡³å°‘åŒ…å«ä¸€ä¸ªç«äº‰é”çš„é˜Ÿåˆ—å’Œä¸€ä¸ªä¿¡å·é˜»å¡é˜Ÿåˆ—(waité˜Ÿåˆ—), å‰è€…è´Ÿè´£åšäº’æ–¥, åä¸€ä¸ªç”¨äºåšçº¿ç¨‹åŒæ­¥.

| é”       | åå‘é”                                                       | è½»é‡çº§é”                                 | é‡é‡çº§é”                       |
| -------- | ------------------------------------------------------------ | ---------------------------------------- | ------------------------------ |
| ä¼˜ç‚¹     | åŠ , è§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—, å’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•ç›¸æ¯”ä»…å­˜åœ¨çº³ç§’çº§å·®è· | ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡, æé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦  | çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹, ä¸ä¼šæ¶ˆè€—CPU |
| ç¼ºç‚¹     | å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰, ä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—                | å§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹, ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPU | çº¿ç¨‹é˜»å¡, å“åº”æ—¶é—´æ…¢            |
| é€‚ç”¨åœºæ™¯ | ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯                                       | è¿½æ±‚å“åº”æ—¶é—´, åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«        | è¿½æ±‚ååé‡, åŒæ­¥å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿  |

## æ­»é”é¢„é˜²

ä»¥ç¡®å®šçš„é¡ºåºè·å¾—é”:åœ¨è®¾è®¡æ—¶å³è€ƒè™‘åˆ°ä¸åŒçº¿ç¨‹é—´é”è·å–çš„é¡ºåº.
è¶…æ—¶æ”¾å¼ƒ:ä½¿ç”¨synchronizedè·å–é”æ—¶,åªè¦æ²¡æœ‰è·å–åˆ°é”å°±ä¼šä¸€ç›´ç­‰å¾…,ä½†Lockæ¥å£å®ç°äº†`tryLock()`,å¯ä»¥æŒ‡å®šè¶…æ—¶æ—¶é—´,

## Q&A

***synchronizedå’ŒReentrantLock***

synchronizedå’Œjava.util.concurrent.locks.Lockçš„å¼‚åŒ

è¿˜åŒ…æ‹¬äº†ä¸­æ–­é”ç­‰å¾…å’Œå®šæ—¶é”ç­‰å¾…

åœ¨å¹¶å‘é‡å°çš„æ—¶å€™, ç”¨synchronizedæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©, å¹¶å‘é‡å¤§çš„æ—¶å€™ç”¨Lock.
Lockæœ‰æ¯”synchronizedæ›´ç²¾ç¡®çš„çº¿ç¨‹è¯­ä¹‰å’Œæ›´å¥½çš„æ€§èƒ½.
synchronizedæ˜¯è‡ªåŠ¨é‡Šæ”¾é”, Lockæ˜¯ä¸»åŠ¨é‡Šæ”¾é”, å¹¶ä¸”å¿…é¡»åœ¨`finally`è¯­å¥ä¸­é‡Šæ”¾
Lockå¯ä¸­æ–­, å¯ä»¥è®¾å®šæ‰€ç­‰å¾…çš„æ—¶é—´, å¯å°è¯•è·å–é”(`tryLock(long timeout, TimeUnit unit)`, ç­‰å¾…å¯ä¸­æ–­), å¯ç»‘å®šå¤šä¸ªCondition
æœ‰äº›æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªç°è±¡, éœ€è¦ç”¨Lockè§£å†³, æ¯”å¦‚åŒæ—¶è¯»æ–‡ä»¶
synchronizedæ˜¯éå…¬å¹³é”, ReentrantLocké»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³é”, ä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”.
éƒ½æ˜¯å¯é‡å…¥çš„.

> [å‚ç…§1](http://blog.csdn.net/maoyeqiu/article/details/46661719)
> [å‚ç…§2](https://blog.csdn.net/zheng548/article/details/54426947)

**lockçš„åŸç†æ˜¯ä»€ä¹ˆ?**

é€šè¿‡AQS(AbstractQueuedSynchronizer)æ¥ç»´æŠ¤ä¸€ä¸ªint
FIFOç­‰å¾…é˜Ÿåˆ—ç®¡ç†è·å–é”çš„æ‰€æœ‰çº¿ç¨‹.
åœ¨"å…¬å¹³é”"çš„æœºåˆ¶ä¸‹, çº¿ç¨‹ä¾æ¬¡æ’é˜Ÿè·å–é”; è€Œ"éå…¬å¹³é”"åœ¨é”æ˜¯å¯è·å–çŠ¶æ€æ—¶, ä¸ç®¡è‡ªå·±æ˜¯ä¸æ˜¯åœ¨é˜Ÿåˆ—çš„å¼€å¤´éƒ½ä¼šè·å–é”. 

## å‚è€ƒ

1. [AbstractQueuedSynchronizeråŠ é”å’Œè§£é”åˆ†æ(äºŒ)](http://suo.iteye.com/blog/1329460)


[![](https://static.segmentfault.com/v-5b1df2a7/global/img/creativecommons-cc.svg)](https://creativecommons.org/licenses/by-nc-nd/4.0/)